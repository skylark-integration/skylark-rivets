/**
 * skylark-rivets - A version of rivets.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-rivets/
 * @license MIT
 */
define(["./rivets"],function(t){function e(t,e,i,h){return new s(t,e,i,h)}function s(t,e,s,h){this.options=h||{},this.options.adapters=this.options.adapters||{},this.obj=t,this.keypath=e,this.callback=s,this.objectPath=[],this.update=this.update.bind(this),this.parse(),i(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function i(t){return"object"==typeof t&&null!==t}function h(t){throw new Error("[sightglass] "+t)}return e.adapters={},s.tokenize=function(t,e,s){var i,h,a=[],o={i:s,path:""};for(i=0;i<t.length;i++)h=t.charAt(i),~e.indexOf(h)?(a.push(o),o={i:h,path:""}):o.path+=h;return a.push(o),a},s.prototype.parse=function(){var t,i,a=this.interfaces();a.length||h("Must define at least one adapter interface."),~a.indexOf(this.keypath[0])?(t=this.keypath[0],i=this.keypath.substr(1)):(void 0===(t=this.options.root||e.root)&&h("Must define a default root adapter."),i=this.keypath),this.tokens=s.tokenize(i,a,t),this.key=this.tokens.pop()},s.prototype.realize=function(){var t,e=this.obj,s=!1;return this.tokens.forEach(function(h,a){i(e)?(void 0!==this.objectPath[a]?e!==(t=this.objectPath[a])&&(this.set(!1,h,t,this.update),this.set(!0,h,e,this.update),this.objectPath[a]=e):(this.set(!0,h,e,this.update),this.objectPath[a]=e),e=this.get(h,e)):(!1===s&&(s=a),(t=this.objectPath[a])&&this.set(!1,h,t,this.update))},this),!1!==s&&this.objectPath.splice(s),e},s.prototype.update=function(){var t,e;(t=this.realize())!==this.target&&(i(this.target)&&this.set(!1,this.key,this.target,this.callback),i(t)&&this.set(!0,this.key,t,this.callback),e=this.value(),this.target=t,(this.value()instanceof Function||this.value()!==e)&&this.callback())},s.prototype.value=function(){if(i(this.target))return this.get(this.key,this.target)},s.prototype.setValue=function(t){i(this.target)&&this.adapter(this.key).set(this.target,this.key.path,t)},s.prototype.get=function(t,e){return this.adapter(t).get(e,t.path)},s.prototype.set=function(t,e,s,i){var h=t?"observe":"unobserve";this.adapter(e)[h](s,e.path,i)},s.prototype.interfaces=function(){var t=Object.keys(this.options.adapters);return Object.keys(e.adapters).forEach(function(e){~t.indexOf(e)||t.push(e)}),t},s.prototype.adapter=function(t){return this.options.adapters[t.i]||e.adapters[t.i]},s.prototype.unobserve=function(){var t;this.tokens.forEach(function(e,s){(t=this.objectPath[s])&&this.set(!1,e,t,this.update)},this),i(this.target)&&this.set(!1,this.key,this.target,this.callback)},t.sightglass=e});
//# sourceMappingURL=sourcemaps/sightglass.js.map
