/**
 * skylark-rivets - A version of rivets.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-rivets/
 * @license MIT
 */
!function(t,e){var i=e.define,n=e.require,s="function"==typeof i&&i.amd,r=!s&&"undefined"!=typeof exports;if(!s&&!i){var o={};i=e.define=function(t,e,i){"function"==typeof i?(o[t]={factory:i,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var i=e.split("/"),n=t.split("/");i.pop();for(var s=0;s<n.length;s++)"."!=n[s]&&(".."==n[s]?i.pop():i.push(n[s]));return i.join("/")}(e,t)}),exports:null},n(t)):o[t]=i},n=e.require=function(t){if(!o.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var i=o[t];if(!i.exports){var s=[];i.deps.forEach(function(t){s.push(n(t))}),i.exports=i.factory.apply(e,s)}return i.exports}}if(!i)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,e){t("skylark-rivets/rivets",["skylark-langx/skylark","./sightglass"],function(t,e){var i={options:["prefix","templateDelimiters","rootInterface","preloadData","handler","executeFunctions"],extensions:[],extensions:["binders","formatters","components","adapters"],public:{binders:{},components:{},formatters:{},adapters:{},prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,executeFunctions:!1,iterationAlias:function(t){return"%"+t+"%"},handler:function(t,e,i){return this.call(t,e,i.view.models)},configure:function(t){var e,n,s,r;for(s in null==t&&(t={}),t)if(r=t[s],"binders"===s||"components"===s||"formatters"===s||"adapters"===s)for(n in r)e=r[n],i[s][n]=e;else i.public[s]=r},bind:function(t,e,n){var s;return null==e&&(e={}),null==n&&(n={}),(s=new i.View(t,e,n)).bind(),s},init:function(t,e,n){var s,r,o;if(null==n&&(n={}),null==e&&(e=document.createElement("div")),t=i.public.components[t],(r=t.template.call(this,e))instanceof HTMLElement){for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(r)}else e.innerHTML=r;return s=t.initialize.call(this,e,n),(o=new i.View(e,s)).bind(),o}}};return t.rivets=i}),t("skylark-rivets/sightglass",["./rivets"],function(t){function e(t,e,n,s){return new i(t,e,n,s)}function i(t,e,i,s){this.options=s||{},this.options.adapters=this.options.adapters||{},this.obj=t,this.keypath=e,this.callback=i,this.objectPath=[],this.update=this.update.bind(this),this.parse(),n(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function n(t){return"object"==typeof t&&null!==t}function s(t){throw new Error("[sightglass] "+t)}return e.adapters={},i.tokenize=function(t,e,i){var n,s,r=[],o={i:i,path:""};for(n=0;n<t.length;n++)s=t.charAt(n),~e.indexOf(s)?(r.push(o),o={i:s,path:""}):o.path+=s;return r.push(o),r},i.prototype.parse=function(){var t,n,r=this.interfaces();r.length||s("Must define at least one adapter interface."),~r.indexOf(this.keypath[0])?(t=this.keypath[0],n=this.keypath.substr(1)):(void 0===(t=this.options.root||e.root)&&s("Must define a default root adapter."),n=this.keypath),this.tokens=i.tokenize(n,r,t),this.key=this.tokens.pop()},i.prototype.realize=function(){var t,e=this.obj,i=!1;return this.tokens.forEach(function(s,r){n(e)?(void 0!==this.objectPath[r]?e!==(t=this.objectPath[r])&&(this.set(!1,s,t,this.update),this.set(!0,s,e,this.update),this.objectPath[r]=e):(this.set(!0,s,e,this.update),this.objectPath[r]=e),e=this.get(s,e)):(!1===i&&(i=r),(t=this.objectPath[r])&&this.set(!1,s,t,this.update))},this),!1!==i&&this.objectPath.splice(i),e},i.prototype.update=function(){var t,e;(t=this.realize())!==this.target&&(n(this.target)&&this.set(!1,this.key,this.target,this.callback),n(t)&&this.set(!0,this.key,t,this.callback),e=this.value(),this.target=t,(this.value()instanceof Function||this.value()!==e)&&this.callback())},i.prototype.value=function(){if(n(this.target))return this.get(this.key,this.target)},i.prototype.setValue=function(t){n(this.target)&&this.adapter(this.key).set(this.target,this.key.path,t)},i.prototype.get=function(t,e){return this.adapter(t).get(e,t.path)},i.prototype.set=function(t,e,i,n){var s=t?"observe":"unobserve";this.adapter(e)[s](i,e.path,n)},i.prototype.interfaces=function(){var t=Object.keys(this.options.adapters);return Object.keys(e.adapters).forEach(function(e){~t.indexOf(e)||t.push(e)}),t},i.prototype.adapter=function(t){return this.options.adapters[t.i]||e.adapters[t.i]},i.prototype.unobserve=function(){var t;this.tokens.forEach(function(e,i){(t=this.objectPath[i])&&this.set(!1,e,t,this.update)},this),n(this.target)&&this.set(!1,this.key,this.target,this.callback)},t.sightglass=e}),t("skylark-rivets/adapter",["./rivets"],function(t){var e=[].indexOf;return t.public.adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(t){var e,i,n;return t.hasOwnProperty(this.id)||(e=this.counter++,Object.defineProperty(t,this.id,{value:e})),(i=this.weakmap)[n=t[this.id]]||(i[n]={callbacks:{}})},cleanupWeakReference:function(t,e){if(!(Object.keys(t.callbacks).length||t.pointers&&Object.keys(t.pointers).length))return delete this.weakmap[e]},stubFunction:function(t,e){var i,n,s;return n=t[e],i=this.weakReference(t),s=this.weakmap,t[e]=function(){var e,r,o,h,a,u,l,p,c;for(r in o=n.apply(t,arguments),u=i.pointers)for(e=u[r],c=null!=(l=null!=(p=s[r])?p.callbacks[e]:void 0)?l:[],h=0,a=c.length;h<a;h++)(0,c[h])();return o}},observeMutations:function(t,i,n){var s,r,o,h,a,u;if(Array.isArray(t)){if(null==(o=this.weakReference(t)).pointers)for(o.pointers={},a=0,u=(r=["push","pop","shift","unshift","sort","reverse","splice"]).length;a<u;a++)s=r[a],this.stubFunction(t,s);if(null==(h=o.pointers)[i]&&(h[i]=[]),e.call(o.pointers[i],n)<0)return o.pointers[i].push(n)}},unobserveMutations:function(t,e,i){var n,s,r;if(Array.isArray(t)&&null!=t[this.id]&&(s=this.weakmap[t[this.id]])&&(r=s.pointers[e]))return(n=r.indexOf(i))>=0&&r.splice(n,1),r.length||delete s.pointers[e],this.cleanupWeakReference(s,t[this.id])},observe:function(t,i,n){var s,r,o,h;return null==(s=this.weakReference(t).callbacks)[i]&&(s[i]=[],(null!=(r=Object.getOwnPropertyDescriptor(t,i))?r.get:void 0)||(null!=r?r.set:void 0)||(o=t[i],Object.defineProperty(t,i,{enumerable:!0,get:function(){return o},set:(h=this,function(n){var r,a,u,l,p;if(n!==o&&(h.unobserveMutations(o,t[h.id],i),o=n,a=h.weakmap[t[h.id]])){if((s=a.callbacks)[i])for(p=s[i].slice(),u=0,l=p.length;u<l;u++)r=p[u],e.call(s[i],r)>=0&&r();return h.observeMutations(n,t[h.id],i)}})}))),e.call(s[i],n)<0&&s[i].push(n),this.observeMutations(t[i],t[this.id],i)},unobserve:function(t,e,i){var n,s,r;if((r=this.weakmap[t[this.id]])&&(n=r.callbacks[e]))return(s=n.indexOf(i))>=0&&(n.splice(s,1),n.length||(delete r.callbacks[e],this.unobserveMutations(t[e],t[this.id],e))),this.cleanupWeakReference(r,t[this.id])},get:function(t,e){return t[e]},set:function(t,e,i){return t[e]=i}},t.public.adapters}),t("skylark-rivets/util",["skylark-utils-dom/query","./rivets"],function(t,e){return e.Util={bindEvent:function(e,i,n){return t(e).on(i,n)},unbindEvent:function(e,i,n){return t(e).off(i,n)},getInputValue:function(e){var i;return"checkbox"===(i=t(e)).attr("type")?i.is(":checked"):i.val()}},e.Util}),t("skylark-rivets/views",["./rivets"],function(t){return t.View=function(){var e=function(t,e){return function(){return t.apply(e,arguments)}};function i(i,n,s){var r,o,h,a,u,l,p,c,d,f,b,v,y;for(this.els=i,this.models=n,null==s&&(s={}),this.update=e(this.update,this),this.publish=e(this.publish,this),this.sync=e(this.sync,this),this.unbind=e(this.unbind,this),this.bind=e(this.bind,this),this.select=e(this.select,this),this.traverse=e(this.traverse,this),this.build=e(this.build,this),this.buildBinding=e(this.buildBinding,this),this.bindingRegExp=e(this.bindingRegExp,this),this.options=e(this.options,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),d=t.extensions,u=0,p=d.length;u<p;u++){if(this[o=d[u]]={},s[o])for(r in f=s[o])h=f[r],this[o][r]=h;for(r in b=t.public[o])h=b[r],null==(a=this[o])[r]&&(a[r]=h)}for(v=t.options,l=0,c=v.length;l<c;l++)this[o=v[l]]=null!=(y=s[o])?y:t.public[o];this.build()}return i.prototype.options=function(){var e,i,n,s,r;for(i={},r=t.extensions.concat(t.options),n=0,s=r.length;n<s;n++)e=r[n],i[e]=this[e];return i},i.prototype.bindingRegExp=function(){return new RegExp("^"+this.prefix+"-")},i.prototype.buildBinding=function(e,i,n,s){var r,o,h,a,u,l,p;return u={},p=function(){var t,e,i,n;for(i=s.match(/((?:'[^']*')*(?:(?:[^\|']*(?:'[^']*')+[^\|']*)+|[^\|]+))|^$/g),n=[],t=0,e=i.length;t<e;t++)l=i[t],n.push(l.trim());return n}(),r=function(){var t,e,i,n;for(i=p.shift().split("<"),n=[],t=0,e=i.length;t<e;t++)o=i[t],n.push(o.trim());return n}(),a=r.shift(),u.formatters=p,(h=r.shift())&&(u.dependencies=h.split(/\s+/)),this.bindings.push(new t[e](this,i,n,a,u))},i.prototype.build=function(){var e,i,n,s,r,o;for(this.bindings=[],o=this,i=function(e){var n,s,r,h,a,u,l,p,c,d,f,b,v;if(3===e.nodeType){if(a=t.TextTemplateParser,(r=o.templateDelimiters)&&(p=a.parse(e.data,r)).length&&(1!==p.length||p[0].type!==a.types.text)){for(c=0,f=p.length;c<f;c++)l=p[c],u=document.createTextNode(l.value),e.parentNode.insertBefore(u,e),1===l.type&&o.buildBinding("TextBinding",u,null,l.value);e.parentNode.removeChild(e)}}else 1===e.nodeType&&(n=o.traverse(e));if(!n)for(v=function(){var t,i,n,s;for(n=e.childNodes,s=[],t=0,i=n.length;t<i;t++)h=n[t],s.push(h);return s}(),d=0,b=v.length;d<b;d++)s=v[d],i(s)},r=this.els,n=0,s=r.length;n<s;n++)e=r[n],i(e);this.bindings.sort(function(t,e){var i,n;return((null!=(i=e.binder)?i.priority:void 0)||0)-((null!=(n=t.binder)?n.priority:void 0)||0)})},i.prototype.traverse=function(e){var i,n,s,r,o,h,a,u,l,p,c,d,f,b,v;for(r=this.bindingRegExp(),o="SCRIPT"===e.nodeName||"STYLE"===e.nodeName,f=e.attributes,l=0,c=f.length;l<c;l++)if(i=f[l],r.test(i.name)){if(a=i.name.replace(r,""),!(s=this.binders[a]))for(h in b=this.binders)u=b[h],"*"!==h&&-1!==h.indexOf("*")&&new RegExp("^"+h.replace(/\*/g,".+")+"$").test(a)&&(s=u);s||(s=this.binders["*"]),s.block&&(o=!0,n=[i])}for(v=n||e.attributes,p=0,d=v.length;p<d;p++)i=v[p],r.test(i.name)&&(a=i.name.replace(r,""),this.buildBinding("Binding",e,a,i.value));return o||(a=e.nodeName.toLowerCase(),this.components[a]&&!e._bound&&(this.bindings.push(new t.ComponentBinding(this,e,a)),o=!0)),o},i.prototype.select=function(t){var e,i,n,s,r;for(s=this.bindings,r=[],i=0,n=s.length;i<n;i++)e=s[i],t(e)&&r.push(e);return r},i.prototype.bind=function(){var t,e,i;for(i=this.bindings,t=0,e=i.length;t<e;t++)i[t].bind()},i.prototype.unbind=function(){var t,e,i;for(i=this.bindings,t=0,e=i.length;t<e;t++)i[t].unbind()},i.prototype.sync=function(){var t,e,i,n;for(n=this.bindings,e=0,i=n.length;e<i;e++)"function"==typeof(t=n[e]).sync&&t.sync()},i.prototype.publish=function(){var t,e,i;for(i=this.select(function(t){var e;return null!=(e=t.binder)?e.publishes:void 0}),t=0,e=i.length;t<e;t++)i[t].publish()},i.prototype.update=function(t){var e,i,n,s,r,o;for(i in null==t&&(t={}),t)n=t[i],this.models[i]=n;for(o=this.bindings,s=0,r=o.length;s<r;s++)"function"==typeof(e=o[s]).update&&e.update(t)},i}(),{View:t.View}}),t("skylark-rivets/binders",["./rivets","./util","./views"],function(t){var e=[].indexOf;return t.public.binders.text=function(t,e){return null!=t.textContent?t.textContent=null!=e?e:"":t.innerText=null!=e?e:""},t.public.binders.html=function(t,e){return t.innerHTML=null!=e?e:""},t.public.binders.show=function(t,e){return t.style.display=e?"":"none"},t.public.binders.hide=function(t,e){return t.style.display=e?"none":""},t.public.binders.enabled=function(t,e){return t.disabled=!e},t.public.binders.disabled=function(t,e){return t.disabled=!!e},t.public.binders.checked={publishes:!0,priority:2e3,bind:function(e){return t.Util.bindEvent(e,"change",this.publish)},unbind:function(e){return t.Util.unbindEvent(e,"change",this.publish)},routine:function(t,e){var i;return"radio"===t.type?t.checked=(null!=(i=t.value)?i.toString():void 0)===(null!=e?e.toString():void 0):t.checked=!!e}},t.public.binders.unchecked={publishes:!0,priority:2e3,bind:function(e){return t.Util.bindEvent(e,"change",this.publish)},unbind:function(e){return t.Util.unbindEvent(e,"change",this.publish)},routine:function(t,e){var i;return"radio"===t.type?t.checked=(null!=(i=t.value)?i.toString():void 0)!==(null!=e?e.toString():void 0):t.checked=!e}},t.public.binders.value={publishes:!0,priority:3e3,bind:function(e){if("INPUT"!==e.tagName||"radio"!==e.type)return this.event="SELECT"===e.tagName?"change":"input",t.Util.bindEvent(e,this.event,this.publish)},unbind:function(e){if("INPUT"!==e.tagName||"radio"!==e.type)return t.Util.unbindEvent(e,this.event,this.publish)},routine:function(t,i){var n,s,r,o,h,a,u;if("INPUT"===t.tagName&&"radio"===t.type)return t.setAttribute("value",i);if(null!=window.jQuery){if(t=jQuery(t),(null!=i?i.toString():void 0)!==(null!=(o=t.val())?o.toString():void 0))return t.val(null!=i?i:"")}else if("select-multiple"===t.type){if(null!=i){for(u=[],s=0,r=t.length;s<r;s++)n=t[s],u.push(n.selected=(h=n.value,e.call(i,h)>=0));return u}}else if((null!=i?i.toString():void 0)!==(null!=(a=t.value)?a.toString():void 0))return t.value=null!=i?i:""}},t.public.binders.if={block:!0,priority:4e3,bind:function(t){var e,i;if(null==this.marker)return e=[this.view.prefix,this.type].join("-").replace("--","-"),i=t.getAttribute(e),this.marker=document.createComment(" rivets: "+this.type+" "+i+" "),this.bound=!1,t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t)},unbind:function(){if(this.nested)return this.nested.unbind(),this.bound=!1},routine:function(e,i){var n,s,r,o;if(!!i==!this.bound){if(i){for(n in r={},o=this.view.models)s=o[n],r[n]=s;return(this.nested||(this.nested=new t.View(e,r,this.view.options()))).bind(),this.marker.parentNode.insertBefore(e,this.marker.nextSibling),this.bound=!0}return e.parentNode.removeChild(e),this.nested.unbind(),this.bound=!1}},update:function(t){var e;return null!=(e=this.nested)?e.update(t):void 0}},t.public.binders.unless={block:!0,priority:4e3,bind:function(e){return t.public.binders.if.bind.call(this,e)},unbind:function(){return t.public.binders.if.unbind.call(this)},routine:function(e,i){return t.public.binders.if.routine.call(this,e,!i)},update:function(e){return t.public.binders.if.update.call(this,e)}},t.public.binders["on-*"]={function:!0,priority:1e3,unbind:function(e){if(this.handler)return t.Util.unbindEvent(e,this.args[0],this.handler)},routine:function(e,i){return this.handler&&t.Util.unbindEvent(e,this.args[0],this.handler),t.Util.bindEvent(e,this.args[0],this.handler=this.eventHandler(i))}},t.public.binders["each-*"]={block:!0,priority:4e3,bind:function(t){var e,i,n,s;if(null==this.marker)e=[this.view.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t);else for(s=this.iterated,i=0,n=s.length;i<n;i++)s[i].bind()},unbind:function(t){var e,i,n;if(null!=this.iterated)for(n=this.iterated,e=0,i=n.length;e<i;e++)n[e].unbind()},routine:function(e,i){var n,s,r,o,h,a,u,l,p,c,d,f,b,v,y,g,m,k,w;if(a=this.args[0],i=i||[],this.iterated.length>i.length)for(m=Array(this.iterated.length-i.length),d=0,v=m.length;d<v;d++)m[d],(c=this.iterated.pop()).unbind(),this.marker.parentNode.removeChild(c.els[0]);for(r=f=0,y=i.length;f<y;r=++f)if(h=i[r],(s={index:r})[t.public.iterationAlias(a)]=r,s[a]=h,null==this.iterated[r]){for(o in k=this.view.models)h=k[o],null==s[o]&&(s[o]=h);l=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,(u=this.view.options()).preloadData=!0,p=e.cloneNode(!0),(c=new t.View(p,s,u)).bind(),this.iterated.push(c),this.marker.parentNode.insertBefore(p,l.nextSibling)}else this.iterated[r].models[a]!==h&&this.iterated[r].update(s);if("OPTION"===e.nodeName)for(w=this.view.bindings,b=0,g=w.length;b<g;b++)(n=w[b]).el===this.marker.parentNode&&"value"===n.type&&n.sync()},update:function(t){var e,i,n,s,r,o;for(i in e={},t)n=t[i],i!==this.args[0]&&(e[i]=n);for(o=this.iterated,s=0,r=o.length;s<r;s++)o[s].update(e)}},t.public.binders["class-*"]=function(t,e){var i;if(i=" "+t.className+" ",!e==(-1!==i.indexOf(" "+this.args[0]+" ")))return t.className=e?t.className+" "+this.args[0]:i.replace(" "+this.args[0]+" "," ").trim()},t.public.binders["*"]=function(t,e){return null!=e?t.setAttribute(this.type,e):t.removeAttribute(this.type)},t.public.binders}),t("skylark-rivets/parsers",["./rivets"],function(t){return t.TypeParser=function(){function t(){}return t.types={primitive:0,keypath:1},t.parse=function(t){return/^'.*'$|^".*"$/.test(t)?{type:this.types.primitive,value:t.slice(1,-1)}:"true"===t?{type:this.types.primitive,value:!0}:"false"===t?{type:this.types.primitive,value:!1}:"null"===t?{type:this.types.primitive,value:null}:"undefined"===t?{type:this.types.primitive,value:void 0}:""===t?{type:this.types.primitive,value:void 0}:!1===isNaN(Number(t))?{type:this.types.primitive,value:Number(t)}:{type:this.types.keypath,value:t}},t}(),t.TextTemplateParser=function(){function t(){}return t.types={text:0,binding:1},t.parse=function(t,e){var i,n,s,r,o,h,a;for(h=[],r=t.length,i=0,n=0;n<r;){if((i=t.indexOf(e[0],n))<0){h.push({type:this.types.text,value:t.slice(n)});break}if(i>0&&n<i&&h.push({type:this.types.text,value:t.slice(n,i)}),n=i+e[0].length,(i=t.indexOf(e[1],n))<0){o=t.slice(n-e[1].length),(null!=(s=h[h.length-1])?s.type:void 0)===this.types.text?s.value+=o:h.push({type:this.types.text,value:o});break}a=t.slice(n,i).trim(),h.push({type:this.types.binding,value:a}),n=i+e[1].length}return h},t}(),{TypeParser:t.TypeParser,TextTemplateParser:t.TextTemplateParser}}),t("skylark-rivets/bindings",["./rivets","./sightglass","./util","./parsers","./views"],function(t){var e=function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function s(){this.constructor=t}return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},i={}.hasOwnProperty,n=[].slice,s=[].indexOf,r=function(t,e){return function(){return t.apply(e,arguments)}};return t.Binding=function(){function e(t,e,i,n,s){this.view=t,this.el=e,this.type=i,this.keypath=n,this.options=null!=s?s:{},this.getValue=r(this.getValue,this),this.update=r(this.update,this),this.unbind=r(this.unbind,this),this.bind=r(this.bind,this),this.publish=r(this.publish,this),this.sync=r(this.sync,this),this.set=r(this.set,this),this.eventHandler=r(this.eventHandler,this),this.formattedValue=r(this.formattedValue,this),this.parseFormatterArguments=r(this.parseFormatterArguments,this),this.parseTarget=r(this.parseTarget,this),this.observe=r(this.observe,this),this.setBinder=r(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={},this.model=void 0,this.setBinder()}return e.prototype.setBinder=function(){var t,e,i;if(!(this.binder=this.view.binders[this.type]))for(t in i=this.view.binders)e=i[t],"*"!==t&&-1!==t.indexOf("*")&&new RegExp("^"+t.replace(/\*/g,".+")+"$").test(this.type)&&(this.binder=e,this.args=new RegExp("^"+t.replace(/\*/g,"(.+)")+"$").exec(this.type),this.args.shift());if(this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function)return this.binder={routine:this.binder}},e.prototype.observe=function(e,i,n){return t.sightglass(e,i,n,{root:this.view.rootInterface,adapters:this.view.adapters})},e.prototype.parseTarget=function(){var e;return(e=t.TypeParser.parse(this.keypath)).type===t.TypeParser.types.primitive?this.value=e.value:(this.observer=this.observe(this.view.models,this.keypath,this.sync),this.model=this.observer.target)},e.prototype.parseFormatterArguments=function(e,i){var n,s,r,o,h,a,u;for(e=function(){var i,n,r;for(r=[],i=0,n=e.length;i<n;i++)s=e[i],r.push(t.TypeParser.parse(s));return r}(),o=[],n=a=0,u=e.length;a<u;n=++a)s=e[n],o.push(s.type===t.TypeParser.types.primitive?s.value:((h=this.formatterObservers)[i]||(h[i]={}),(r=this.formatterObservers[i][n])||(r=this.observe(this.view.models,s.value,this.sync),this.formatterObservers[i][n]=r),r.value()));return o},e.prototype.formattedValue=function(t){var e,i,s,r,o,h,a,u,l;for(u=this.formatters,i=h=0,a=u.length;h<a;i=++h)s=u[i],e=s.match(/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g),r=e.shift(),s=this.view.formatters[r],o=this.parseFormatterArguments(e,i),(null!=s?s.read:void 0)instanceof Function?t=(l=s.read).call.apply(l,[this.model,t].concat(n.call(o))):s instanceof Function&&(t=s.call.apply(s,[this.model,t].concat(n.call(o))));return t},e.prototype.eventHandler=function(t){var e,i;return i=(e=this).view.handler,function(n){return i.call(t,this,n,e)}},e.prototype.set=function(e){var i;return e=e instanceof Function&&!this.binder.function&&t.public.executeFunctions?this.formattedValue(e.call(this.model)):this.formattedValue(e),null!=(i=this.binder.routine)?i.call(this,this.el,e):void 0},e.prototype.sync=function(){var t,e;return this.set(function(){var i,n,s,r,o,h,a;if(this.observer){if(this.model!==this.observer.target){for(o=this.dependencies,i=0,s=o.length;i<s;i++)(e=o[i]).unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&(null!=(h=this.options.dependencies)?h.length:void 0))for(a=this.options.dependencies,n=0,r=a.length;n<r;n++)t=a[n],e=this.observe(this.model,t,this.sync),this.dependencies.push(e)}return this.observer.value()}return this.value}.call(this))},e.prototype.publish=function(){var t,e,i,s,r,o,h,a,u,l,p,c,d;if(this.observer){for(a=this.getValue(this.el),o=this.formatters.length-1,p=this.formatters.slice(0).reverse(),i=u=0,l=p.length;u<l;i=++u)s=p[i],e=o-i,t=s.split(/\s+/),r=t.shift(),h=this.parseFormatterArguments(t,e),(null!=(c=this.view.formatters[r])?c.publish:void 0)&&(a=(d=this.view.formatters[r]).publish.apply(d,[a].concat(n.call(h))));return this.observer.setValue(a)}},e.prototype.bind=function(){var t,e,i,n,s,r,o;if(this.parseTarget(),null!=(s=this.binder.bind)&&s.call(this,this.el),null!=this.model&&(null!=(r=this.options.dependencies)?r.length:void 0))for(o=this.options.dependencies,i=0,n=o.length;i<n;i++)t=o[i],e=this.observe(this.model,t,this.sync),this.dependencies.push(e);if(this.view.preloadData)return this.sync()},e.prototype.unbind=function(){var t,e,i,n,s,r,o,h,a;for(null!=(r=this.binder.unbind)&&r.call(this,this.el),null!=(o=this.observer)&&o.unobserve(),h=this.dependencies,n=0,s=h.length;n<s;n++)h[n].unobserve();for(i in this.dependencies=[],a=this.formatterObservers)for(t in e=a[i])e[t].unobserve();return this.formatterObservers={}},e.prototype.update=function(t){var e,i;return null==t&&(t={}),this.model=null!=(e=this.observer)?e.target:void 0,null!=(i=this.binder.update)?i.call(this,t):void 0},e.prototype.getValue=function(e){return this.binder&&null!=this.binder.getValue?this.binder.getValue.call(this,e):t.Util.getInputValue(e)},e}(),t.ComponentBinding=function(i){function n(e,i,n){var o,h,a,u,l,p,c,d;for(this.view=e,this.el=i,this.type=n,this.unbind=r(this.unbind,this),this.bind=r(this.bind,this),this.locals=r(this.locals,this),this.component=this.view.components[this.type],this.static={},this.observers={},this.upstreamObservers={},h=e.bindingRegExp(),c=this.el.attributes||[],l=0,p=c.length;l<p;l++)o=c[l],h.test(o.name)||(a=this.camelCase(o.name),u=t.TypeParser.parse(o.value),s.call(null!=(d=this.component.static)?d:[],a)>=0?this.static[a]=o.value:u.type===t.TypeParser.types.primitive?this.static[a]=u.value:this.observers[a]=o.value)}return e(n,i),n.prototype.sync=function(){},n.prototype.update=function(){},n.prototype.publish=function(){},n.prototype.locals=function(){var t,e,i,n,s,r;for(t in i={},s=this.static)n=s[t],i[t]=n;for(t in r=this.observers)e=r[t],i[t]=e.value();return i},n.prototype.camelCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},n.prototype.bind=function(){var e,i,n,s,r,o,h,a,u,l,p,c,d,f,b,v,y,g,m,k;if(!this.bound){for(i in f=this.observers)n=f[i],this.observers[i]=this.observe(this.view.models,n,function(t){return function(e){return function(){return t.componentView.models[e]=t.observers[e].value()}}}(this).call(this,i));this.bound=!0}if(null!=this.componentView)this.componentView.bind();else{for(this.el.innerHTML=this.component.template.call(this),h=this.component.initialize.call(this,this.el,this.locals()),this.el._bound=!0,o={},b=t.extensions,l=0,c=b.length;l<c;l++){if(r=b[l],o[r]={},this.component[r])for(e in v=this.component[r])a=v[e],o[r][e]=a;for(e in y=this.view[r])a=y[e],null==(u=o[r])[e]&&(u[e]=a)}for(g=t.options,p=0,d=g.length;p<d;p++)r=g[p],o[r]=null!=(m=this.component[r])?m:this.view[r];for(i in this.componentView=new t.View(Array.prototype.slice.call(this.el.childNodes),h,o),this.componentView.bind(),k=this.observers)s=k[i],this.upstreamObservers[i]=this.observe(this.componentView.models,i,function(t){return function(e,i){return function(){return i.setValue(t.componentView.models[e])}}}(this).call(this,i,s))}},n.prototype.unbind=function(){var t,e,i,n;for(t in e=this.upstreamObservers)e[t].unobserve();for(t in i=this.observers)i[t].unobserve();return null!=(n=this.componentView)?n.unbind.call(this):void 0},n}(t.Binding),t.TextBinding=function(t){function i(t,e,i,n,s){this.view=t,this.el=e,this.type=i,this.keypath=n,this.options=null!=s?s:{},this.sync=r(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={}}return e(i,t),i.prototype.binder={routine:function(t,e){return t.data=null!=e?e:""}},i.prototype.sync=function(){return i.__super__.sync.apply(this,arguments)},i}(t.Binding),{Binding:t.Binding,ComponentBinding:t.ComponentBinding,TextBinding:t.TextBinding}}),t("skylark-rivets/formatters",["./rivets"],function(t){var e=[].slice;return t.public.formatters.call=function(){var t,i;return i=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],i.call.apply(i,[this].concat(e.call(t)))},t.public.formatters}),t("skylark-rivets/factory",["./rivets","./adapter","./binders","./bindings","./formatters","./parsers","./util","./views"],function(t){return t.factory=function(e){return t.sightglass=e,t.public._=t,t.public},t.factory}),t("skylark-rivets/main",["./sightglass","./factory"],function(t,e){return new e(t)}),t("skylark-rivets",["skylark-rivets/main"],function(t){return t})}(i),!s){var h=n("skylark-langx/skylark");r?module.exports=h:e.skylarkjs=h}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-rivets.js.map
